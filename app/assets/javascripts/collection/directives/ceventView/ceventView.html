<div id="panel-parent" class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      Visit # {{vm.collectionEvent.visitNumber}}
      <a data-toggle="collapse"
         href="#collapseCevent"
         class="btn btn-xs btn-default pull-right"
         ng-click="vm.panelButtonClicked()">
        <i class="glyphicon"
           ng-class="vm.panelOpen ? 'glyphicon-chevron-down' : 'glyphicon-chevron-right'"></i>
      </a>
    </h3>
  </div>
  <div id="collapseCevent" class="panel-collapse collapse in" aria-expanded="true">
    <ul class="list-group">
      <li class="list-group-item">
        <div class="row">
          <div class="col-md-3">
            <strong>Visit type</strong>
          </div>
          <div class="col-md-7">
            {{vm.collectionEvent.collectionEventType.name}}
          </div>
          <div class="col-md-2" ng-if="vm.canUpdateVisitType">
            <button class="btn btn-xs btn-primary pull-right"
                    title="Update visit type"
                    ng-click="vm.editVisitType()">
              <i class="glyphicon glyphicon-edit"></i>
            </button>
          </div>
        </div>
      </li>
      <li class="list-group-item">
        <div class="row">
          <div class="col-md-3">
            <strong>Time completed</strong>
          </div>
          <div class="col-md-7">
            {{vm.timeCompletedLocal}}
          </div>
          <div class="col-md-2">
            <button class="btn btn-xs btn-primary pull-right"
                    title="Update time completed"
                    ng-click="vm.editTimeCompleted()">
              <i class="glyphicon glyphicon-edit"></i>
            </button>
          </div>
        </div>
      </li>
      <li class="list-group-item" ng-repeat="annotation in vm.collectionEvent.annotations">
        <div class="row">
          <div class="col-md-3">
            <strong>{{annotation.getLabel()}}</strong>
          </div>
          <div class="col-md-7">
            {{annotation.getValue()}}
          </div>
          <div class="col-md-2">
            <button class="btn btn-xs btn-primary pull-right"
                    title="Update {{annotation.getLabel()}}"
                    ng-click="vm.editAnnotation(annotation)">
              <i class="glyphicon glyphicon-edit"></i>
            </button>
          </div>
        </div>
      </li>
    </ul>
    <status-line item="vm.collectionEvent"></status-line>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Specimens
      <span class="btn-group pull-right">
        <button class="btn btn-xs btn-default"
                title="add specimens"
                ng-click="vm.addSpecimens()">
          <i class="glyphicon glyphicon-plus"></i>
        </button>
      </span>
    </h3>
  </div>

  <ul class="list-group" ng-if="vm.specimens.length <= 0">
    <li class="list-group-item">
      <div class="panel panel-warning">
        <div class="panel-heading">
          No specimens collected yet.
        </div>
      </div>
    </li>
  </ul>

  <table st-table="vm.specimens"
         st-pipe="vm.getTableData"
         class="table table-striped table-condensed">
    <thead>
      <tr>
        <th st-sort="inventoryId">Inventory ID</th>
        <th>Amount</th>
        <th>Type</th>
        <th st-sort="timeCreated">Time created</th>
        <th>Location</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody ng-if="!vm.tableDataLoading">
      <tr ng-repeat="specimen in vm.specimens">
        <td>{{specimen.inventoryId}}</td>
        <td>{{specimen.amount}} {{specimen.units}}</td>
        <td>{{specimen.specimenSpecName}}</td>
        <td>{{specimen.timeCreated| localTime}}</td>
        <td>{{specimen.locationName}}</td>
        <td>
          <button class="btn btn-xs btn-warning"
                  ng-click="vm.removeSpecimen(specimen)"
                  title="Remove">
            <i class="glyphicon glyphicon-remove"></i>
          </button>
        </td>
      </tr>
    </tbody>
    <tbody ng-if="vm.tableDataLoading">
      <tr>
        <td colspan="5" class="text-center">Loading ... </td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="5" class="text-center">
          <div st-items-by-page="vm.pageSize"
               st-pagination=""
               st-template="/assets/javascripts/common/directives/pagination.html"></div>
        </td>
      </tr>
    </tfoot>
  </table>

</div>
