@(studyId: String,
    studyName: String,
    annotationTypes: Set[_ <: org.biobank.domain.study.StudyAnnotationType],
    headingMsg: String,
    noneMsg: String,
    addAction: Call,
    updateAction: (String, String, String) => Call,
    removeAction: (String, String, String) => Call)(
    implicit request: play.api.mvc.WrappedRequest[play.api.mvc.AnyContent])

@import tags._
@import controllers.study._
@import org.biobank.domain.AnnotationValueType._
@import org.biobank.domain.study.ParticipantAnnotationType

<h4>
  @headingMsg
  <a href="@addAction"
    class="btn btn-small btn-primary" type="button"
    data-toggle="tooltip" title="@Messages("biobank.common.action.add")">
    <i class="icon-plus-sign icon-white"></i></a>
</h4>

@if(annotationTypes.isEmpty) {
  @alertBlock { }{
    @Messages("biobank.study.specimen.link.annotation.type.show.none")
  }
  </div>
} else {
      <table class="table table-bordered table-hover table-condensed">
        <thead>
          <th>@Messages("biobank.common.name")</th>
          <th>@Messages("biobank.annotation.type.field.value.type")</th>

          @annotationTypes.head match {
            case at : ParticipantAnnotationType => {
              <th>@Messages("biobank.study.participant.annotation.type.field.required")</th>
            }
            case _ => { }
          }

          <th>@Messages("biobank.annotation.type.field.max.value.count")</th>
          <th>@Messages("biobank.annotation.type.field.options")</th>
          <th></th>
        </thead>
        <tbody>
          @for(annotType <- annotationTypes) {
            <tr>
              <td>@nameWithDescriptionPopup(annotType.id.id, annotType.name, annotType.description)</td>
              <td><span class="label">@annotType.valueType</span></td>

              @annotType match {
                case at: ParticipantAnnotationType => {
                  <td>@if(at.required) { @Messages("biobank.common.yes") } else { @Messages("biobank.common.no") }</td>
                }
                case _ => { }
              }

              @if(annotType.valueType == org.biobank.domain.AnnotationValueType.Select) {
                  @if(annotType.maxValueCount.getOrElse(0) == 1) {
                    <td>@Messages("biobank.annotation.type.field.max.value.count.single")</td>
                  } else {
                    @if(annotType.maxValueCount.getOrElse(0) > 1) {
                      <td>@Messages("biobank.annotation.type.field.max.value.count.multiple")</td>
                    } else {
                      <td><span class="label label-warning">ERROR: @@annotType.maxValueCount</span></td>
                    }
                  }
                <td>@Html(annotType.options.map( m => m.values.mkString("<br/>")).getOrElse("") )</td>
              } else {
                <td><span class="label">N/A</span></td>
                <td><span class="label">N/A</span></td>
              }

              <td>
                @updateRemoveButtons(
                    updateAction(studyId, studyName, annotType.id.id),
                    removeAction(studyId, studyName, annotType.id.id))
              </td>
            <tr>
          }
        </tbody>
      </table>

  <script type="text/javascript" charset="utf-8">
      @Html(annotationTypes.map(sg => """$('#%s').popover();""".format(sg.id)).mkString("\n"))
  </script>
}

