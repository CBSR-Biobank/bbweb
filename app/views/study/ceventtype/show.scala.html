@(studyId: String, 
    studyName: String, 
    ceventTypes: Set[domain.study.CollectionEventType],    
    specimenGroupMap: Seq[(String, String, String)],    
    annotationTypeMap: Seq[(String, String)])(implicit request: play.api.mvc.WrappedRequest[play.api.mvc.AnyContent],
    flash: play.api.mvc.Flash)
    
@import controllers.study._
@import domain.AnnotationValueType._

@main(Messages("biobank.study.singular") + " " + studyName) {
  @breadcrumbs(Map(
    (Messages("biobank.study.plural") -> routes.StudyController.index),
    (studyName -> routes.StudyController.showStudy(studyId)),
    (Messages("biobank.study.collection.event.type.show.title") -> null)
  ))
  <div class="page-header">
    <h2>@studyName<small> @Messages("biobank.study.collection.event.type.show.title")
    <a href="@routes.CeventTypeController.addCeventType(studyId)" 
        class="btn btn-small btn-primary" type="button"
        data-toggle="tooltip" title="@Messages("biobank.common.action.add")">
        <i class="icon-plus-sign icon-white"></i></a>
    </small></h2>
  </div>
  <div class="clearfix">
      @if(ceventTypes.size <= 0) {
          <p>@Messages("biobank.study.collection.event.type.show.none")</p>
      } else {

    @flash.get("success").map { message =>
      <div class="alert alert-success">
        @message
      </div>
    }

    <table class="table table-bordered table-hover table-condensed">
      <thead>
        <th>@Messages("biobank.common.name")</th>
        <th>@Messages("biobank.common.description")</th>
        <th>@Messages("biobank.study.collection.event.type.field.recurring")</th>
        <th>
            @Messages("biobank.study.collection.event.type.field.specimen.group.data")<br/>
            <small>@Messages("biobank.study.collection.event.type.field.specimen.group.data.desc")</small>
        </th>
        <th>
            @Messages("biobank.study.collection.event.type.field.annotation.type.data")<br/>
            <small>@Messages("biobank.study.collection.event.type.field.annotation.type.data.desc")</small>
        </th>
        <th></th>
      </thead>
      <tbody>
        @for(ceventtype <- ceventTypes) {
          <tr>
            <td>@ceventtype.name</td>
            <td>@ceventtype.description</td>
            <td>
              @if(ceventtype.recurring){ 
                @Messages("biobank.common.yes")
              } else { 
                @Messages("biobank.common.no")
              }</td>        
            <td>
                @Html(ceventtype.specimenGroupData.map(sgData =>
                    "%s (%d - %.3f)".format(
                    specimenGroupMap.find(x => x._1.equals(sgData.specimenGroupId)).map(_._2).getOrElse(""),
                    sgData.count, sgData.amount)).mkString("<br/>"))
            </td> 
            <td>          
                @Html(ceventtype.annotationTypeData.map(atData =>
                    "%s (%s)".format(
                    annotationTypeMap.find(x => x._1.equals(atData.annotationTypeId)).map(_._2).getOrElse(""),
                    if (atData.required) "Y" else "N")).mkString("<br/>"))
            </td>                
            <td> 
              @updateRemoveButtons(
                  routes.CeventTypeController.updateCeventType(studyId,studyName,ceventtype.id.id),
                  routes.CeventTypeController.removeCeventTypeConfirm(studyId,studyName,ceventtype.id.id)
              )
            </td>   
          <tr>
        }
      </tbody>
    </table>
      } 
  
  </div>    
}
    